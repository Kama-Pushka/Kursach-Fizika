TEST_count = {
	set_temp_variable = { count = 0 }
	every_country = {
		add_to_temp_variable = { count = 1 }
	}
	log = "[?count]"
}

NW_WOS_randomize_world = {
	SAI = { set_country_flag = rmap_ctr }
	1193 = { set_state_flag = rmap_reserved set_state_flag = rmap_owned }
	
	every_state = {
		for_each_loop = {
			array = core_countries
			value = c
			
			remove_core_of = c
		}
		set_demilitarized_zone = no
	}
	every_possible_country = { 
		every_state = { remove_claim_by = PREV } 
	}
	every_country = {
		limit = { has_war = yes }
		every_enemy_country = { white_peace = PREV }
	}
	
	NW_WOS_create_random_country_on_every_continent = yes
	
	NW_WOS_create_other_countries = yes
	
	NW_WOS_generate_states = yes
	
	every_country = {
		limit = {
			any_owned_state = {
				NOT = {is_core_of = PREV}
			}
		}
		every_owned_state = {
			limit = {
				NOT = {is_core_of = PREV}
			}
			add_core_of = PREV
		}
	}
}

NW_WOS_create_random_country_on_every_continent = {
	add_to_temp_array = { continents = token:europe }
	add_to_temp_array = { continents = token:africa }
	add_to_temp_array = { continents = token:asia }
	add_to_temp_array = { continents = token:south_america }
	add_to_temp_array = { continents = token:middle_east }
	add_to_temp_array = { continents = token:north_america }
	for_each_loop = {
		array = continents
		value = token
		
		NW_WOS_create_random_country = yes
	}
	
	add_to_temp_array = { regions = 154 }
	add_to_temp_array = { regions = 156 }
	add_to_temp_array = { regions = 160 }
	add_to_temp_array = { regions = 1 } # 2 3
	add_to_temp_array = { regions = 4 } # 119
	add_to_temp_array = { regions = 41 }
	for_each_loop = {
		array = regions
		value = token
		
		NW_WOS_create_random_country = yes
	}
}

NW_WOS_create_random_country = {
	random_country = { 
		limit = { NOT = { has_country_flag = rmap_ctr } } 
		set_country_flag = rmap_ctr 
		random_state = {
			limit = {
				NOT = { has_state_flag = rmap_reserved } 
				if = {
					limit = { check_variable = { token < 1000 } check_variable = { token > 0 } } # диапазон регионов
					meta_trigger = {
						text = { region = [REGION] }
						REGION = "[?token]"
					}
				}
				else = {
					meta_trigger = {
						text = { is_on_continent = [CONTINENT] }
						CONTINENT = "[?token.GetTokenKey]"
					}
					is_island_state = no
				}
			}
			set_state_flag = rmap_reserved 
			set_state_flag = rmap_owned 
			PREV = {
				transfer_state = PREV 
				set_capital = PREV 
				goto_state = PREV
			} 
			add_core_of = PREV 
			add_manpower = 200000 
			set_building_level = { type = industrial_complex level = 2 } 
			set_building_level = { type = arms_factory level = 2 } 
			set_state_flag = capital_@PREV
		} 
	}
}

NW_WOS_create_other_countries = {
	every_country = {
		limit = { NOT = { has_country_flag = rmap_ctr } }
		random_state = {
			limit = {
				NOT = { has_state_flag = rmap_owned }
			} 
			set_state_flag = rmap_owned 
			PREV = {
				transfer_state = PREV 
				set_capital = PREV 
				goto_state = PREV
			} 
			add_core_of = PREV 
			add_manpower = 250000 
			set_building_level={type = industrial_complex level = 2} 
			set_building_level={type = arms_factory level = 2} 
			set_state_flag = capital_@PREV
		}
		
		random_list = { 
			25={add_popularity = {ideology = fascism popularity = 0.25} set_politics = { ruling_party = fascism } }
			25={add_popularity = {ideology = communism popularity = 0.25} set_politics = { ruling_party = communism } }
			25={add_popularity = {ideology = democratic popularity = 0.25} set_politics = { ruling_party = democratic } set_politics = { elections_allowed = yes }}
			25={add_popularity = {ideology = neutrality popularity = 0.25} set_politics = { ruling_party = neutrality }}
		}
 
		#Necessary as the game doesn't update tag for some reason
		set_cosmetic_tag = D99
		drop_cosmetic_tag = yes
		
		NW_WOS_add_state = yes
	}
	
	every_country = {
		NW_WOS_add_state = yes
	}
	every_country = {
		NW_WOS_add_state = yes
	}
	every_country = {
		NW_WOS_add_state = yes
	}
}

NW_WOS_add_state = { 
	country_event = rmap.2 # да почему блять (возможно ивенты реально лучше справляются с высокой нагрузкой для большого кол-ва стран?)
}

NW_WOS_generate_states = {
	every_state = {
		if = { 
			limit = {
				NOT = { has_state_flag = rmap_owned }
			} 
			set_state_flag = rmap_owned 
			random_country = {
				limit = {
					any_owned_state = {
						OR = { is_coastal = yes is_island_state = yes } has_state_flag = rmap_owned
					}
				} 
				transfer_state = PREV
			} 
		}
		NW_WOS_add_manpower_to_state = yes
		NW_WOS_add_manpower_to_state = yes
	  
		random_list = { 2 = {} 1 = { set_building_level={ type = industrial_complex level = 1 } } }
		random_list = { 3 = {} 1 = { set_building_level={ type = arms_factory level = 2 } } }
		random_list = { 2 = {} 1 = { set_building_level={ type = dockyard level = 1 } } }
		random_list = { 5 = {} 1 = { set_building_level={ type = air_base level = 1 } } }
  
		NW_WOS_add_resources_to_state = yes
		
		random_list={
			15={}
			11={set_building_level ={type = infrastructure level = 1}}
			6={set_building_level ={type = infrastructure level = 2}}
			3={set_building_level ={type = infrastructure level = 3}}
			2={set_building_level ={type = infrastructure level = 4}}
			1={set_building_level ={type = infrastructure level = 5}}
		}
		random_list = { 
			2={set_state_category = wasteland}
			3={set_state_category = pastoral}
			6={set_state_category = rural}
			8={set_state_category = town}
			7={set_state_category = large_town}
			5={set_state_category = city}
			4={set_state_category = large_city}
			2={set_state_category = metropolis}
			1={set_state_category = megalopolis}
		}
		OWNER = {add_equipment_to_stockpile = {type = infantry_equipment_0 amount = 750}}
	}
}

NW_WOS_add_manpower_to_state = {
	if = { 
		limit = { is_island_state = no }
		random_list = {
			45 = { add_manpower = 25000 } 
			45 = { add_manpower = 250000 } 
			25 = { add_manpower = 500000 } 
			15 = { add_manpower = 900000 } 
			12 = { add_manpower = 1600000 } 
			3 = { add_manpower = 2800000 }
		}
		if = {
			limit = { is_coastal = yes } 
			OWNER = {
				add_equipment_to_stockpile = { type = convoy_1 amount = 4 }
			}
		}
		else = {
			random_list = {
				30 = { add_manpower = 8000 } 
				15 = { add_manpower = 80000 } 
				20 = { add_manpower = 160000 } 
				30 = { add_manpower = 350000 } 
				20 = { add_manpower = 700000 } 
				15 = { add_manpower = 950000 }
			}
			OWNER = {
				add_equipment_to_stockpile = { type = convoy_1 amount = 4 }
			}
		}
	}
	else = { 
		random_list = {
			45 = { add_manpower = 2500 } 
			45 = { add_manpower = 25000 } 
			25 = { add_manpower = 50000 } 
			15 = { add_manpower = 90000 } 
			12 = { add_manpower = 16000 } 
			3 = { add_manpower = 28000 }
		}
	}
}

NW_WOS_add_resources_to_state = {
	random_list = {
		13={}
		2={
			random_list={
				1={add_resource={type = oil amount = 120}}
				2={add_resource={type = oil amount = 80}}
				4={add_resource={type = oil amount = 60}}
				6={add_resource={type = oil amount = 30}}
				9={add_resource={type = oil amount = 10}}
			}
		}
		3={
			random_list={
				1={add_resource={type = chromium amount = 120}}
				2={add_resource={type = chromium amount = 80}}
				4={add_resource={type = chromium amount = 60}}
				5={add_resource={type = chromium amount = 30}}
				6={add_resource={type = chromium amount = 10}}
			}
		}
		4={
			random_list={
				1={add_resource={type = rubber amount = 120}}
				2={add_resource={type = rubber amount = 80}}
				4={add_resource={type = rubber amount = 60}}
				6={add_resource={type = rubber amount = 30}}
				4={add_resource={type = rubber amount = 20}}
				8={add_resource={type = rubber amount = 10}}
			}
		}
		5={
			random_list={
				1={add_resource={type = tungsten amount = 120 }}
				2={add_resource={type = tungsten amount = 80 }}
				4={add_resource={type = tungsten amount = 60 }}
				5={add_resource={type = tungsten amount = 30 }}
				4={add_resource={type = tungsten amount = 20 }}
				6={add_resource={type = tungsten amount = 10 }}
			}
		}
		6={
			random_list={
				1={add_resource={type = aluminium amount = 120 }}
				2={add_resource={type = aluminium amount = 80 }}
				3={add_resource={type = aluminium amount = 60 }}
				4={add_resource={type = aluminium amount = 30 }}
				3={add_resource={type = aluminium amount = 20 }}
				5={add_resource={type = aluminium amount = 10 }}
			}
		}
		7={
			random_list={
				1={add_resource={type = steel amount = 120 }}
				2={add_resource={type = steel amount = 80 }}
				3={add_resource={type = steel amount = 60 }}
				4={add_resource={type = steel amount = 30 }}
				3={add_resource={type = steel amount = 20 }}
				5={add_resource={type = steel amount = 10 }}
			}
		}
	}
}